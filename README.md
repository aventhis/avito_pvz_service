# Сервис для работы с ПВЗ

Данный сервис предоставляет API для управления пунктами выдачи заказов (ПВЗ) и приемкой товаров.

## Функциональность

- Авторизация пользователей (модераторов и сотрудников ПВЗ)
- Создание и получение информации о ПВЗ
- Управление приемкой товаров (создание, закрытие)
- Управление товарами в рамках приемки (добавление, удаление)

## Структура проекта

- `cmd/` - точки входа в приложение
- `internal/` - внутренние пакеты приложения (не экспортируемые)
  - `api/` - обработчики HTTP-запросов
  - `auth/` - аутентификация и авторизация
  - `models/` - структуры данных
  - `storage/` - работа с хранилищем данных
  - `tests/` - интеграционные тесты

## Технологии

- Go 1.21
- PostgreSQL
- Docker & Docker Compose

## Запуск проекта

### Через Docker Compose

1. Клонируйте репозиторий:
```
git clone https://github.com/aventhis/avito_pvz_service.git
cd avito_pvz_service
```

2. Запустите приложение с помощью Docker Compose:
```
docker-compose up -d
```

3. Приложение будет доступно по адресу http://localhost:8080

### Локальный запуск

1. Установите Go 1.21 и PostgreSQL.

2. Клонируйте репозиторий:
```
git clone https://github.com/aventhis/avito_pvz_service.git
cd avito_pvz_service
```

3. Установите зависимости:
```
go mod download
```

4. Настройте переменные окружения:
```
export DB_URL=postgres://postgres:postgres@localhost:5432/postgres?sslmode=disable
export JWT_SECRET=your-secret-key
export PORT=8080
```

5. Запустите приложение:
```
go run cmd/main/main.go
```

## API

### Аутентификация

- `POST /dummyLogin` - Получение тестового токена с указанной ролью
- `POST /register` - Регистрация пользователя
- `POST /login` - Авторизация пользователя

### ПВЗ

- `POST /pvz` - Создание ПВЗ (только для модераторов)
- `GET /pvz` - Получение списка ПВЗ с фильтрацией по дате и пагинацией
- `POST /pvz/{pvzId}/close_last_reception` - Закрытие последней приемки
- `POST /pvz/{pvzId}/delete_last_product` - Удаление последнего добавленного товара

### Приемки и товары

- `POST /receptions` - Создание новой приемки
- `POST /products` - Добавление товара в текущую приемку

## Тестирование

```
go test ./...
```

## Замечания по реализации

- ПВЗ можно создавать только в трех городах: Москва, Санкт-Петербург и Казань
- Товары в приемке можно удалять только в порядке LIFO (последний добавленный - первый удаленный)
- Нельзя создать новую приемку, если предыдущая не закрыта
- Нельзя добавлять товары в закрытую приемку
- Нельзя удалять товары из закрытой приемки